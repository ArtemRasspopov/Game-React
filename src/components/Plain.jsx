import React, { useEffect, useRef } from "react";
import { useDispatch, useSelector } from "react-redux";
import { setGameOver } from "../redux/slices/plaintsSlice";

const Plain = ({ id }) => {
  const plainRef = useRef(null);
  const plain = useSelector((state) => state.plaintsSlice.plains[id]);
  const activePlain = useSelector((state) => state.plaintsSlice.activePlain);
  const dispatch = useDispatch();

  useEffect(() => {
    plainRef.current.addEventListener("animationend", () => {
      dispatch(setGameOver(id));
    });
  }, [id, activePlain, dispatch]);

  return (
    <div
      className={`plane ${plain.killed ? "plane--killed" : ""}`}
      style={{ top: `${plain.killed ? "100vh" : plain.height + "px"}` }}
      ref={plainRef}
    >
      {!plain.killed && (
        <div
          className="plain__word"
          style={id === activePlain ? { opacity: 1 } : { opacity: 0.2 }}
        >
          {plain.word.split("").map((letter, id) => (
            <p
              key={id}
              style={{
                backgroundColor: `${
                  id < plain.letters ? "rgba(171, 20, 20, 0.712)" : ""
                }`,
              }}
            >
              {letter}
            </p>
          ))}
        </div>
      )}

      <svg
        style={
          plain.killed
            ? { transform: "rotate(50deg)" }
            : { transform: "rotate(0)" }
        }
        width="92"
        height="30"
        viewBox="0 0 92 30"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M66.52 4.71143H66.5212C69.3877 4.71143 72.1578 5.64394 74.4259 7.33821C74.3579 7.42107 74.2973 7.51132 74.2417 7.60921C74.0736 7.8341 72.6996 9.51111 69.0662 9.51111C68.7682 9.51111 68.4578 9.49991 68.1449 9.47633C66.0303 9.32429 63.2578 8.47096 60.0646 6.99698C60.1203 6.95732 60.1759 6.9178 60.2304 6.87682L60.4616 6.70621C62.2164 5.41153 64.3398 4.71143 66.52 4.71143Z"
          fill="#242424"
        />
        <path
          d="M58.7204 25.9919C59.5242 25.7632 60.2612 25.3304 60.8548 24.7306L61.0663 24.5179C61.1615 24.4227 61.2456 24.32 61.3186 24.2125L61.3668 24.2113C62.0445 24.1889 62.6542 24.5018 63.0413 24.9989C63.7351 25.0336 64.3929 25.3229 64.8839 25.8189L65.0966 26.0329C65.1794 26.1169 65.1794 26.2517 65.0966 26.3359L64.8839 26.5497C64.4165 27.0222 63.7969 27.3091 63.1389 27.3659C62.7877 27.9026 62.1892 28.2674 61.4978 28.2897L31.1624 29.2642C30.5428 29.284 30.0247 28.7981 30.0049 28.1797L29.9963 27.9298L56.0417 27.0926C57.0471 27.0605 57.997 26.6622 58.7204 25.9919Z"
          fill="#242424"
        />
        <path
          d="M25.5073 21.8877L55.8429 20.9129C56.5207 20.8911 57.1302 21.2038 57.5174 21.7007C58.2113 21.7358 58.8697 22.0251 59.3607 22.5213L59.5727 22.7353C59.6555 22.8192 59.6555 22.9538 59.5727 23.0378L59.3607 23.2517C58.8927 23.7244 58.2733 24.011 57.6157 24.0675C57.2637 24.6052 56.6651 24.9694 55.974 24.9916L25.6383 25.9665C25.0191 25.9863 24.501 25.5005 24.4811 24.8813L24.4221 23.0449C24.4022 22.4257 24.8881 21.9078 25.5073 21.8877Z"
          fill="#242424"
        />
        <path
          d="M0.295986 17.9809C0.663429 17.6096 1.14997 17.3847 1.66642 17.3402C1.94296 16.9179 2.41303 16.6319 2.95583 16.6144L5.84584 16.5215C6.11434 15.9698 6.59087 15.5285 7.19519 15.3142L13.5112 13.0738C14.4136 12.7537 14.907 11.7827 14.6338 10.8649L12.1021 2.3658C11.7948 1.33408 12.5677 0.297363 13.6442 0.297363H16.9569C18.1209 0.297363 19.224 0.81737 19.9648 1.71536L26.5454 9.69239C27.36 10.6798 28.6073 11.2046 29.8827 11.0963L39.1316 10.3123L39.1182 9.90424C39.0983 9.29518 39.5758 8.78531 40.1848 8.76529C40.7939 8.7454 41.3038 9.22298 41.3237 9.83204L41.3333 10.1256L47.5781 9.59609L47.5424 8.50733C47.5225 7.89839 47.9999 7.38853 48.609 7.3685C49.2179 7.34861 49.7278 7.82606 49.7477 8.43513L49.7797 9.4094L54.5881 9.00164C55.6939 8.90797 56.7731 8.64777 57.7927 8.23685C60.6595 9.66328 64.6449 11.3319 67.9944 11.5736C73.9922 12.0064 76.0174 8.73709 76.0174 8.73709L80.698 9.55854C83.0253 9.96722 85.3072 10.6026 87.5107 11.4558L90.9274 12.779C92.0106 13.1985 92.0347 14.7224 90.9654 15.1758L86.2181 17.1891C85.2558 17.5972 84.4922 18.3666 84.0913 19.3318C83.495 20.7672 82.1192 21.7258 80.566 21.7878L76.1989 21.9625L76.2275 22.8372C76.2473 23.4463 75.7699 23.956 75.1608 23.976C74.5518 23.9959 74.0419 23.5183 74.022 22.9094L73.9939 22.0505L68.3453 22.2764L68.3971 23.8561C68.4169 24.4652 67.9395 24.9751 67.3304 24.9948C66.7214 25.0147 66.2115 24.5373 66.1916 23.9282L66.1404 22.3644L63.1619 22.4835C62.6769 22.2604 62.148 22.132 61.5992 22.1105C61.4894 21.7992 61.3141 21.506 61.0681 21.2572L60.8547 21.0416C60.2071 20.3872 59.3944 19.935 58.5078 19.726C57.7795 19.1358 56.8709 18.8092 55.91 18.8092C55.8654 18.8092 55.8206 18.81 55.7757 18.8114L25.4402 19.7862C23.6635 19.8434 22.2643 21.3353 22.3212 23.1119L22.3477 23.9324C20.2383 23.7459 18.1613 23.2585 16.1813 22.4804C13.5936 21.4637 10.8383 20.9418 8.05814 20.9418H7.99464C7.10179 20.9418 6.32447 20.4511 5.91434 19.7257L3.05938 19.8174C2.52699 19.8346 2.04835 19.589 1.74428 19.1987C1.19924 19.1711 0.682133 18.9439 0.296509 18.5541L0.129984 18.3861C0.0649004 18.3203 0.0649004 18.2143 0.129984 18.1486L0.295986 17.9809Z"
          fill="#242424"
        />
      </svg>
      {id === activePlain && (
        <div className="aim">
          <svg
            width="87"
            height="87"
            viewBox="0 0 87 87"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M44.9649 10.3061V0.866211H42.2774V10.3061C24.8221 10.9981 10.753 25.0671 10.061 42.5225H0.621124V45.21H10.061C10.753 62.6653 24.8221 76.7343 42.2774 77.4264V86.8662H44.9649V77.4264C62.4202 76.7343 76.4893 62.6653 77.1813 45.21H86.6211V42.5225H77.1813C76.4893 25.0671 62.4202 10.9981 44.9649 10.3061ZM44.9649 74.7389V65.3662H42.2774V74.7389C26.3015 74.0509 13.4365 61.1858 12.7485 45.21H22.1211V42.5225H12.7485C13.4365 26.5466 26.3015 13.6816 42.2774 12.9936V22.3662H44.9649V12.9936C60.9407 13.6816 73.8058 26.5466 74.4938 42.5225H65.1211V45.21H74.4938C73.8058 61.1858 60.9407 74.0509 44.9649 74.7389Z"
              fill="#822929"
            />
          </svg>
        </div>
      )}
    </div>
  );
};

export default Plain;
